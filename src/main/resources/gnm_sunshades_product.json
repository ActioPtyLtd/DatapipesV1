{
  "script": {
    "schema": {},
    "tasks": {
      "read-product-eyeware-csv": {
        "type": "extract",
        "behavior": "simple",
        "dataSource": {
          "behavior": "regex",
          "directory": "C:\\Users\\mauri\\bitbucket\\gandm-data",
          "type": "file",
          "filenameTemplate": "2016-05-15_19.30.01_stock-master.txt"
        }
      },
      "parse-product-eyeware-csv": {
        "type": "transform",
        "batch": [
          "split2colsD,col1,\\|",
          "const,eye_ware,2016-01-01",
          "rename,col2,product_group,col3,externalId,col4,external_status,col5,model,col6,rx,col7,online_frame_colour,col8,frame_colour,col9,lens_colour,col10,Olens_width,col11,Onose_bridge,col12,Otemple_length,col13,Oframe_depth,col14,category,col15,OwholesalePrice,col16,OretailPrice,col17,Oapn,col18,gender,col19,shape,col20,frame_type,col21,frame_material,col22,lens_material",
          "rename,const1,type,const2,datecreated",
          "defaultIfBlank,Olens_width,Onose_bridge,Otemple_length,Oframe_depth,OwholesalePrice,OretailPrice,Oapn,0",
          "rename,Olens_width1,lens_width,Onose_bridge1,nose_bridge,Otemple_length1,temple_length,Oframe_depth1,frame_depth,OwholesalePrice1,wholesalePrice,OretailPrice1,retailPrice,Oapn1,apn",
          "rename,model,name",
          "copy,externalId,internalId",
          "keep,internalId,externalId,type,name,wholesalePrice,retailPrice",
          "numeric,wholesalePrice,19,2",
          "numeric,retailPrice,19,2"
        ],
        "_comment": "keep,product_group,externalId,external_status,model,rx,online_frame_colour,frame_colour,lens_colour,lens_width,nose_bridge,temple_length,frame_depth,category,wholesalePrice,retailPrice,apn,gender,shape,frame_type,frame_material,lens_material"
      },
      "update-product-eyeware-db": {
        "type": "datasourceupdate",
        "behavior": "",
        "keys": [
          "externalId"
        ],
        "dataSource": {
          "type": "sql",
          "behavior": "",
          "jdbcDriver": "org.postgresql.Driver",
          "connect": "jdbc:postgresql://localhost/test?user=postgres&password=postgres",
          "query": {
            "maxid": "select max(productid) from product_eyeware",
            "queryTemplate": "",
            "create": "insert into product_eyeware (datecreated,\"type\",\"product_group\",externalId,external_status,model,rx,\"online_frame_colour\",\"frame_colour\",\"lens_colour\",\"lens_width\",\"nose_bridge\",\"temple_length\",\"frame_depth\",category,\"wholesalePrice\",retailPrice,apn,gender,shape,\"frame_type\",\"frame_material\",\"lens_material\") values (@datecreated::timestamp,@type,@product_group,@externalId,@external_status,@model,@rx,@online_frame_colour,@frame_colour,@lens_colour,@lens_width::numeric,@nose_bridge::numeric,@temple_length::numeric,@frame_depth::numeric,@category,@wholesalePrice::numeric,@retailPrice::numeric,@apn::bigint,@gender,@shape,@frame_type,@frame_material,@lens_material)",
            "read": "select * from product_eyeware",
            "update": ""
          }
        }
      },
      "update-product-api": {
        "type": "load",
        "behavior": "",
        "dataSource": {
          "type": "rest",
          "behavior": "simple",
          "path": "https://dev-api-gnm.actio.com.au:8443/api/product/",
          "credential": {
            "user": "admin",
            "password": "password"
          }
        }
      }
    },
    "pipelines": {
      "load-product-eyeware" : {
        "pipe": "read-product-eyeware-csv | parse-product-eyeware-csv | update-product-api"
      }
    },
    "services": {
      "name001": {
        "path": "/a/b/c",
        "pipe": "p00411"
      }
    },
    "startup": {
      "exec": "load-product-eyeware"
    }
  }
}
