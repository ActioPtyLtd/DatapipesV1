{
  "script": {
    "schema": {},
    "tasks": {
      "read-product-api": {
        "type": "extract",
        "behavior": "",
        "dataSource": {
          "type": "rest",
          "behavior": "simple",
          "path": "https://api.sunshad.es/v1/stock",
          "credential": {
            "user": "gm",
            "password": "83498dd4fa301a3aa2d117b13d371526"
          },
          "query": {
            "read": "https://api.sunshad.es/v1/stock"
          }
        }
      },
      "parse-product-api": {
        "type": "transform",
        "batch": [
          "pick,items",
          "const,frame",
          "rename,const1,type,stockid,external_id",
          "keep,external_id,type,name,discontinued,apn,description,retail_price,retail_price_tax,wholesale_price,wholesale_price_tax,frame_brand,frame_bridge_size,frame_colour,frame_depth,frame_eye_size,frame_gender,frame_material,frame_model,frame_temple_length,frame_type",
          "numeric,retail_price,0,2",
          "numeric,wholesale_price,0,2",
          "numeric,retail_price_tax,0,2",
          "numeric,wholesale_price_tax,0,2",
          "bool,discontinued",
          "productProperty,frame_brand,frame_bridge_size,frame_colour,frame_depth,frame_eye_size,frame_gender,frame_material,frame_model,frame_temple_length,frame_type"
        ]
      },
      "update-product-api": {
        "type": "load",
        "behavior": "update",
        "dataSource": {
          "type": "rest",
          "behavior": "simple",
          "path": "https://dev-api-gnm.actio.com.au:8443/service/product",
          "credential": {
            "user": "admin",
            "password": "password"
          }
        }
      },
      "parse-stock-api": {
        "type": "transform",
        "batch": [
          "pick,items",
          "const,SUNSHADES",
          "rename,stockid,external_id,const1,supplier_id,supplier_total,quantity",
          "keep,external_id,supplier_id,retail_price,retail_price_tax,wholesale_price,wholesale_price_tax,quantity",
          "numeric,quantity,0,0",
          "numeric,retail_price,0,2",
          "numeric,wholesale_price,0,2",
          "numeric,retail_price_tax,0,2",
          "numeric,wholesale_price_tax,0,2"
        ]
      },
      "update-stock-api": {
        "type": "load",
        "behavior": "update",
        "dataSource": {
          "type": "rest",
          "behavior": "simple",
          "path": "https://dev-api-gnm.actio.com.au:8443/service/stock",
          "credential": {
            "user": "admin",
            "password": "password"
          },
          "query": {
            "create": {
              "header": "https://dev-api-gnm.actio.com.au:8443/service/product/@external_id/stock"
            },
            "update": {
              "header": "https://dev-api-gnm.actio.com.au:8443/service/product/@external_id/stock"
            }
          }
        }
      }
    },
    "pipelines": {
      "load-frame" : {
        "pipe": "read-product-api | parse-product-api | update-product-api"
      },
      "load-stock" : {
        "pipe": "read-product-api | parse-stock-api | update-stock-api"
      }
    },
    "services": {
      "name001": {
        "path": "/a/b/c",
        "pipe": "p00411"
      }
    },
    "startup": {
      "exec": "load-stock"
    }
  }
}
