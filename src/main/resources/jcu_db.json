{
  "script": {
    "schema": {},
    "tasks": {
      "read-users": {
        "type": "extract",
        "behavior": "",
        "dataSource": {
          "type": "sql",
          "behavior": "",
          "jdbcDriver": "org.postgresql.Driver",
          "connect": "jdbc:postgresql://localhost/jcu?user=postgres&password=postgres",
          "query": {
            "queryTemplate": "",
            "read": "select distinct PresenterUsername,PresenterFullname,PresenterFullname firstname,PresenterFullname lastname,coalesce(PresenterEmail,PresenterUsername || '@jcu.edu.au') email from current_activities where PresenterUsername is not null order by PresenterUsername desc"
          }
        }
      },
      "template": {
        "type": "mergeTemplate",
        "templates": {
          "createbody": "{ \"UserName\": \"$presenterusername\",\"DisplayName\": \"$presenterfullname\",\"Email\":\"$presenterusername@actio.com.au\",\"Activated\": true,\"ModeratorEmail\": \"jmckinney_webcastcloud.com.au\",\"ModeratorEmailOptOut\": false,\"DisablePresentationContentCompleteEmails\": false,\"DisablePresentationContentFailedEmails\": true,\"DisablePresentationChangeOwnerEmails\": true,\"TimeZone\": 19,\"PresenterFirstName\": \"First\",\"PresenterMiddleName\": \"Middle\",\"PresenterLastName\": \"Last\",\"PresenterEmail\": \"jmckinneywebcastcloud.com.au\",\"PresenterPrefix\": \"null\",\"PresenterSuffix\": \"null\",\"PresenterAdditionalInfo\": \"null\",\"PresenterBio\": \"null\" }"
        }
      },
      "update-mediasite-users": {
        "type": "datasourceupdate",
        "behavior": "",
        "iterateR": "ds => ds.value",
        "keyL": "${row.presenterusername}",
        "keyR": "$UserName",
        "changeL": "${row.presenterfullname}",
        "changeR": "$DisplayName",
        "dataSource": {
          "type": "rest",
          "behavior": "simple",
          "path": "-",
          "headers": {
            "Content-Type": "application/json",
            "sfapikey": "6ee2ac1c-6045-496f-892e-a0ad3dd5976c"
          },
          "credential": {
            "user": "ACTIO",
            "password": "ACTIO1234!"
          },
          "query": {
            "create": {
              "uri": "http://devmediasite.webcastcloud.com.au/mediasite/api/v1/UserProfiles",
              "body": "createbody"
            },
            "read": {
              "uri": "http://devmediasite.webcastcloud.com.au/mediasite/api/v1/UserProfiles"
            }
          }
        }
      }
    },
    "pipelines": {
      "load-frame" : {
        "pipe": "read-users | template-module | update-mediasite-users"
      }
    },
    "services": { },
    "startup": {
      "exec": "load-frame"
    }
  }
}
