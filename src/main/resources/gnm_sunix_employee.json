{
  "script": {
    "schema": {},
    "tasks": {
      "read-doctor-csv": {
        "type": "extract",
        "behavior": "simple",
        "dataSource": {
          "behavior": "regex",
          "directory": "C:\\Users\\mauri\\bitbucket\\gandm-data\\Sunix\\Hewitt-PHHEW\\2016-06-15",
          "type": "file",
          "filenameTemplate": "VDOCTOR.CSV"
        }
      },
      "parse-doctor-csv": {
        "type": "transform",
        "batch": [
          "split2cols,col1",
          "row1header",
          "const,Specialist,,,,61,,true,true,true,true,PHHEW,-,1900-01-01",
          "concat,const11,code,-",
          "rename,concat1,externalref,gname,firstname,sname,lastname,phone,phonenumber",
          "rename,const1,employeetype,const2,middlename,const3,preferredname,const4,preferredcontactmethod,const5,phonecountryid,const6,phonerawnumber,const7,phonesmsenabled,const8,phonefax,const9,phonelandline,const10,phonemobile,const12,gender,const13,birthdate",
          "keep,externalref,employeetype,employmentstartdate,employmentenddate,firstname,lastname,middlename,title,gender,birthdate,preferredname,preferredcontactmethod,email,phonecountryid,phonenumber,phonerawnumber,phonemobile,phonesmsenabled,phonefax,phonelandline"]
      },
      "update-employee-db": {
        "type": "datasourceupdate",
        "behavior": "",
        "keys": [
          "externalref"
        ],
        "dataSource": {
          "type": "sql",
          "behavior": "",
          "jdbcDriver": "org.postgresql.Driver",
          "connect": "jdbc:postgresql://ec2-54-206-28-87.ap-southeast-2.compute.amazonaws.com/postgres?user=postgres&password=afxQeY3d{Pwvh",
          "query": {
            "queryTemplate": "",
            "create": "insert into employee (createddate,externalref,employeetype,employmentstartdate,employmentenddate,firstname,lastname,middlename,title,gender,birthdate,preferredname,preferredcontactmethod,email,phonecountryid,phonenumber,phonerawnumber,phonemobile,phonesmsenabled,phonefax,phonelandline) values (current_date,@externalref,@employeetype,current_date,current_date,@firstname,@lastname,@middlename,@title,@gender,@birthdate::date,@preferredname,@preferredcontactmethod,@email,@phonecountryid::int,@phonenumber,@phonerawnumber,@phonemobile::bool,@phonesmsenabled::bool,@phonefax::bool,@phonelandline::bool)",
            "read": "select * from employee",
            "update": "update employee set employeetype=@employeetype,employmentstartdate=current_date,employmentenddate=current_date,firstname=@firstname,lastname=@lastname,middlename=@middlename,title=@title,gender=@gender,birthdate=@birthdate::date,preferredname=@preferredname,preferredcontactmethod=@preferredcontactmethod,email=@email,phonecountryid=@phonecountryid::int,phonenumber=@phonenumber,phonerawnumber=@phonerawnumber,phonemobile=@phonemobile::bool,phonesmsenabled=@phonesmsenabled::bool,phonefax=@phonefax::bool,phonelandline=@phonelandline::bool where externalref=@externalref"
          }
        }
      }
    },
    "pipelines": {
      "load-employee" : {
        "pipe" : "read-doctor-csv | parse-doctor-csv | update-employee-db"
      }
    },
    "services": { },
    "startup": {
      "exec": "load-employee"
    }
  }
}
